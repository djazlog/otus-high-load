# WebSocket Server Documentation

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ä–∞–∑–¥–µ–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** —Å –¥–≤—É–º—è –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏:

### üöÄ HTTP Server (REST API)
- **–ü–æ—Ä—Ç**: 8089 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**: `HTTP_HOST`, `HTTP_PORT`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: REST API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –¥—Ä—É–∑—å—è–º–∏

### üîå WebSocket Server (Real-time Updates)
- **–ü–æ—Ä—Ç**: 8090 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)  
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**: `WEBSOCKET_HOST`, `WEBSOCKET_PORT`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ª–µ–Ω—Ç—ã

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

1. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–µ—Ä –º–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
2. **–ò–∑–æ–ª—è—Ü–∏—è**: –ü—Ä–æ–±–ª–µ–º—ã –≤ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–æ–π
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –†–∞–∑–Ω—ã–µ –ø–æ—Ä—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ç—Ä–∞—Ñ–∏–∫–∞

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# HTTP Server
HTTP_HOST=localhost
HTTP_PORT=8089

# WebSocket Server  
WEBSOCKET_HOST=localhost
WEBSOCKET_PORT=8090
```

### –ó–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
HTTP_HOST=localhost HTTP_PORT=8089 WEBSOCKET_HOST=localhost WEBSOCKET_PORT=8090 go run cmd/server/main.go

# –ò–ª–∏ —á–µ—Ä–µ–∑ Makefile
make run
```

## WebSocket API

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```javascript
// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket —Å–µ—Ä–≤–µ—Ä—É
const wsUrl = 'ws://localhost:8090/post/feed/posted?token=' + encodeURIComponent(jwtToken);
const ws = new WebSocket(wsUrl);
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç JWT —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å:

1. **URL –ø–∞—Ä–∞–º–µ—Ç—Ä**: `?token=your-jwt-token`
2. **HTTP –∑–∞–≥–æ–ª–æ–≤–æ–∫**: `Authorization: Bearer your-jwt-token`

### –°–æ–æ–±—â–µ–Ω–∏—è

#### –í—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–æ—Ç —Å–µ—Ä–≤–µ—Ä–∞)

```json
{
  "type": "post",
  "payload": {
    "postId": "uuid",
    "postText": "–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞",
    "authorUserId": "uuid"
  }
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. HTML —Ç–µ—Å—Ç –∫–ª–∏–µ–Ω—Ç

–û—Ç–∫—Ä–æ–π—Ç–µ `docs/websocket_test.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ:
- **Server URL**: `ws://localhost:8090` (WebSocket —Å–µ—Ä–≤–µ—Ä)
- **JWT Token**: –ü–æ–ª—É—á–∏—Ç–µ —á–µ—Ä–µ–∑ REST API

### 2. Go —Ç–µ—Å—Ç –∫–ª–∏–µ–Ω—Ç

```bash
# –°–±–æ—Ä–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞
make build-websocket-client

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
make websocket-test
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

1. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ—Å—Ç —á–µ—Ä–µ–∑ REST API: `POST http://localhost:8089/posts`
2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ WebSocket: `ws://localhost:8090/post/feed/posted`
3. –ü–æ–ª—É—á–∏—Ç–µ real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –ø–æ—Å—Ç–µ

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

```bash
# HTTP —Å–µ—Ä–≤–µ—Ä
2025/08/19 08:31:15 HTTP server starting on localhost:8089

# WebSocket —Å–µ—Ä–≤–µ—Ä  
2025/08/19 08:31:15 WebSocket server starting on localhost:8090
2025/08/19 08:31:15 WebSocket connection registered: user-id
```

### –ú–µ—Ç—Ä–∏–∫–∏

- **HTTP —Å–µ—Ä–≤–µ—Ä**: Prometheus –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –ø–æ—Ä—Ç—É 2112
- **WebSocket —Å–µ—Ä–≤–µ—Ä**: –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ WebSocket

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. WebSocket —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—Ç—É
2. JWT —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω
3. –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π—Ä–≤–æ–ª–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ
2. RabbitMQ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. Feed worker –∑–∞–ø—É—â–µ–Ω

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. JWT —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫
2. –¢–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ (URL –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫)
3. –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á JWT –Ω–∞—Å—Ç—Ä–æ–µ–Ω
